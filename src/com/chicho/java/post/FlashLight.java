package com.chicho.java.post;

import java.net.URI;
import java.net.URLEncoder;
import java.net.http.HttpClient;
import java.net.http.HttpRequest;
import java.net.http.HttpResponse;
import java.nio.charset.StandardCharsets;
import java.util.Date;
import java.util.HashMap;
import java.util.Map;

public class FlashLight {

    private final HttpClient httpClient = HttpClient.newBuilder()
            .version(HttpClient.Version.HTTP_2)
            .build();

    public static void main(String[] args) throws Exception {

        FlashLight obj = new FlashLight();

        System.out.println("Sandip - Initiating Http POST request... Time: "+new Date());
        String[] orders = {"V4022174771","V4022174782","V4022174797","V4022174841","V4022174846","V4022174861","V4022174867","V4022174922","V4022174923","V4022174933","V4022174948","V4022174952","V4022174963","V4022174967","V4022174974","V4022175001","V4022175007","V4022175009","V4022175039","V4022175042","V4022175055","V4022175067","V4022175074","V4022175079","V4022175098","V4022175105","V4022175114","V4022175122","V4022175151","V4022175179","V4022175205","V4022175216","V4022175235","V4022175247","V4022175254","V4022175264","V4022175290","V4022175300","V4022175301","V4022175339","V4022175355","V4022175363","V4022175374","V4022175383","V4022175389","V4022175396","V4022175410","V4022175429","V4022175433","V4022175447","V4022175466","V4022175552","V4022175557","V4022175600","V4022175618","V4022175620","V4022175633","V4022175636","V4022175652","V4022175653","V4022203734","V4022203738","V4022203753","V4022203754","V4022203785","V4022203788","V4022203792","V4022203803","V4022203804","V4022203815","V4022203821","V4022203846","V4022203848","V4022203854","V4022203877","V4022203908","V4022203921","V4022203922","V4022203938","V4022204019","V4022204025","V4022204037","V4022204039","V4022204040","V4022204067","V4022204075","V4022204079","V4022204080","V4022204091","V4022204094","V4022204123","V4022204124","V4022204133","V4022204141","V4022204150","V4022204155","V4022204164","V4022204187","V4022204202","V4022204257","V4022204259","V4022204274","V4022204284","V4022204302","V4022204333","V4022204335","V4022204346","V4022204364","V4022204366","V4022204385","V4022204393","V4022204394","V4022204396","V4022204415","V4022204419","V4022204421","V4022204447","V4022204462","V4022204491","V4022204495","V4022204501","V4022204507","V4022204544","V4022204565","V4022204580","V4022204586","V4022204591","V4022204609","V4022204627","V4022204637","V4022204648","V4022204671","V4022204672","V4022204673","V4022204675","V4022204700","V4022204716","V4022204747","V4022204751","V4022204768","V4022204769","V4022204796","V4022204803","V4022204809","V4022204830","V4022204841","V4022204857","V4022204879","V4022204886","V4022204899","V4022205023","V4022205039","V4022205046","V4022205052","V4022205066","V4022205069","V4022205071","V4022205110","V4022205147","V4022205161","V4022205168","V4022205177","V4022205179","V4022205192","V4022205204","V4022205210","V4022205220","V4022205248","V4022205309","V4022205310","V4022205311","V4022205318","V4022205319","V4022205320","V4022205363","V4022205456","V4022205462","V4022205465","V4022205466","V4022205505","V4022205532","V4022205540","V4022205555","V4022205559","V4022205561","V4022205572","V4022205579","V4022205596","V4022205599","V4022205604","V4022205631","V4022205645","V4022205650","V4022205654","V4022205655","V4022205679","V4022205701","V4022205707","V4022205721","V4022205761","V4022205771","V4022205790","V4022205791","V4022205809","V4022205817","V4022205820","V4022205833","V4022205835","V4022205853","V4022205854","V4022205867","V4022205881","V4022205891","V4022205897","V4022205982","V4022206019","V4022206022","V4022206030","V4022206037","V4022206042","V4022206067","V4022206078","V4022206085","V4022206087","V4022206089","V4022206100","V4022206107","V4022206116","V4022206134","V4022206136","V4022206137","V4022206146","V4022206158","V4022206203","V4022206223","V4022206224","V4022206225","V4022206235","V4022206240","V4022206252","V4022206259","V4022206279","V4022206328","V4022206334","V4022206346","V4022206352","V4022206357","V4022206367","V4022206381","V4022206438","V4022206449","V4022206454","V4022206465","V4022206466","V4022206485","V4022206493","V4022206503","V4022206524","V4022206559","V4022206562","V4022206569","V4022206584","V4022206607","V4022206620","V4022206622","V4022206625","V4022206640","V4022206662","V4022206706","V4022206718","V4022206735","V4022206758","V4022206776","V4022206797","V4022206804","V4022206817","V4022206862","V4022206879","V4022206881","V4022206889","V4022206897","V4022206920","V4022206923","V4022206945","V4022206961","V4022206978","V4022206994","V4022207012","V4022207036","V4022207079","V4022207095","V4022207112","V4022207122","V4022207128","V4022207132","V4022207150","V4022207178","V4022207192","V4022207200","V4022207203","V4022207215","V4022207254","V4022207259","V4022207285","V4022207294","V4022207311","V4022207353","V4022207375","V4022207380","V4022207442","V4022207444","V4022207455","V4022207507","V4022207528","V4022207558","V4022207571","V4022207688","V4022207690","V4022207707","V4022207718","V4022207755","V4022207824","V4022207832","V4022207840","V4022207859","V4022207883","V4022207925","V4022207966","V4022207982","V4022208003","V4022208016","V4022208022","V4022208050","V4022208071","V4022208073","V4022208101","V4022208102","V4022208119","V4022208121","V4022208132","V4022208136","V4022208137","V4022208141","V4022208148","V4022208153","V4022208157","V4022208162","V4022208200","V4022208202","V4022208203","V4022208208","V4022208228","V4022208230","V4022208244","V4022208245","V4022208264","V4022208275","V4022208278","V4022208284","V4022208302","V4022208316","V4022208357","V4022208383","V4022208387","V4022208515","V4022208545","V4022208562","V4022208565","V4022208587","V4022208595","V4022208694","V4022208786","V4022208791","V4022208820","V4022208844","V4022208847","V4022208852","V4022208856","V4022208864","V4022208876","V4022208879","V4022208948","V4022208986","V4022208998","V4022209006","V4022209051","V4022209057","V4022209084","V4022209092","V4022209093","V4022209099","V4022209111","V4022209135","V4022209138","V4022209157","V4022209185","V4022209207","V4022209213","V4022209252","V4022179678","V4022179684","V4022179705","V4022179738","V4022179758","V4022179794","V4022179797","V4022179836","V4022179839","V4022179840","V4022179873","V4022179881","V4022179926","V4022179930","V4022179938","V4022179956","V4022179964","V4022179979","V4022179996","V4022179999","V4022180002","V4022180023","V4022180052","V4022180085","V4022180089","V4022180092","V4022180111","V4022180124","V4022180138","V4022180161","V4022180177","V4022180191","V4022180208","V4022180215","V4022180271","V4022180320","V4022180364","V4022180392","V4022180423","V4022180431","V4022180435","V4022180452","V4022180462","V4022180520"};
        int length = orders.length;
        int i = 0;
        for(String order: orders){
            i++;
            System.out.print(order + " ("+(i*100)/length+"%), ");
            obj.sendPost(order);
        }
        System.out.println("Chicholikar - Http POST request Completed! Time: "+new Date());

    }

    private void sendPost(String orderNumber) throws Exception {

        // form parameters
        Map<Object, Object> data = new HashMap<>();
        //data.put("username", "sandip");
        //data.put("password", "test1234");

        HttpRequest request = HttpRequest.newBuilder()
                .POST(buildFormDataFromMap(data))
                .uri(URI.create("https://dsapi.prod.int.footlocker.com/ds-order-replication-service/api/replication/ad-hoc/orders/"+orderNumber))
                .setHeader("User-Agent", "SandipChicholikarJava Bot") // add request header
                .header("Content-Type", "application/x-www-form-urlencoded")
                .build();

        HttpResponse<String> response = httpClient.send(request, HttpResponse.BodyHandlers.ofString());

        // print status code
        if(response.statusCode() != 200){
            //System.out.println(response.statusCode());
            System.out.println(" ***"+orderNumber+"###, ");
        }

        // print response body
        //System.out.println(response.body());

    }

    private static HttpRequest.BodyPublisher buildFormDataFromMap(Map<Object, Object> data) {
        var builder = new StringBuilder();
        for (Map.Entry<Object, Object> entry : data.entrySet()) {
            if (builder.length() > 0) {
                builder.append("&");
            }
            builder.append(URLEncoder.encode(entry.getKey().toString(), StandardCharsets.UTF_8));
            builder.append("=");
            builder.append(URLEncoder.encode(entry.getValue().toString(), StandardCharsets.UTF_8));
        }
        //System.out.println(builder.toString());
        return HttpRequest.BodyPublishers.ofString(builder.toString());
    }
}
